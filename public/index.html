<!doctype html>
<html lang="en" data-theme="">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>Dealers Plus</title>

    <!-- Bootstrap 5 + Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <!-- Dealers Plus theme (new) -->
    <link href="./theme.css" rel="stylesheet" />
  </head>
  <body>
    <!-- Top Nav -->
    <nav class="navbar navbar-expand-lg navbar-glass fixed-top">
      <div class="container">
        <a class="navbar-brand d-flex align-items-center gap-2" href="#/">
          <span class="brand-mark"></span>
          <span class="fw-bold">Dealers Plus</span>
        </a>

        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navCollapse"
          aria-controls="navCollapse"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navCollapse">
          <div class="ms-auto d-flex align-items-center gap-3 w-100 w-lg-auto">
            <!-- Search -->
            <div class="dropdown flex-grow-1" style="min-width: min(640px, 75vw);">
              <div class="input-group shadow-sm rounded-3 overflow-hidden">
                <input
                  id="searchInput"
                  type="text"
                  class="form-control search-input"
                  placeholder='Try "Denver CO", "94107", "Toyota", or a dealer name'
                  autocomplete="off"
                />
                <button class="btn btn-primary" id="searchGo" aria-label="Search">
                  <i class="bi bi-search"></i>
                </button>
              </div>
              <div id="suggestions" class="dropdown-menu w-100"></div>
            </div>

            <!-- Theme orb -->
            <button
              id="themeToggle"
              class="btn p-0 border-0 theme-orb"
              type="button"
              aria-label="Toggle theme"
              title="Toggle theme"
              data-next="dark"
            ></button>

            <!-- Account -->
            <button id="btnAccount" class="btn btn-outline-secondary">
              <i class="bi bi-person"></i> Account
            </button>

            <div id="navUserWrapper" class="d-none">
              <div class="dropdown">
                <button class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                  <i class="bi bi-person-circle me-1"></i>
                  <span id="navUserName">User</span>
                </button>
                <div class="dropdown-menu dropdown-menu-end">
                  <button class="dropdown-item" id="btnLogout">
                    <i class="bi bi-box-arrow-right me-2"></i>Sign out
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </nav>

    <!-- Alerts -->
    <div class="container mt-4">
      <div id="globalAlert" class="alert d-none" role="alert"></div>
    </div>

    <!-- Main View Root -->
    <main class="container my-4">
      <div id="viewRoot"></div>
    </main>

    <!-- Footer -->
    <footer class="border-top py-4 bg-white-75 glass mt-5">
      <div class="container d-flex flex-wrap justify-content-between align-items-center gap-2">
        <small class="text-muted">
          Data © OpenStreetMap contributors (ODbL). Please attribute “© OpenStreetMap contributors”.
        </small>
        <small class="text-muted">© <span id="year"></span> Dealers Plus</small>
      </div>
    </footer>

    <!-- Templates -->
    <!-- Home / About becomes a full hero with supporting cards (IDs unchanged so app.js still works) -->
    <template id="tpl-about">
      <section class="hero-section rounded-4 mb-4">
        <div class="container text-center text-white">
          <h1 class="display-5 fw-semibold mb-2">Find dealers. Read real reviews.</h1>
          <p class="lead text-white-75 mb-4">
            Search by ZIP, city &amp; state, brand, or dealer name — fast.
          </p>
          <div class="d-flex justify-content-center gap-2 flex-wrap">
            <a href="#/dealers?brand=Toyota" class="btn btn-primary-soft rounded-pill">
              <i class="bi bi-ev-front me-1"></i> Toyota
            </a>
            <a href="#/dealers?brand=Honda" class="btn btn-primary-soft rounded-pill">
              <i class="bi bi-ev-front me-1"></i> Honda
            </a>
            <a href="#/dealers?brand=Ford" class="btn btn-primary-soft rounded-pill">
              <i class="bi bi-ev-front me-1"></i> Ford
            </a>
            <a href="#/dealers?state=CA" class="btn btn-primary-soft rounded-pill">
              <i class="bi bi-geo-alt me-1"></i> California
            </a>
            <a href="#/dealers?state=TX" class="btn btn-primary-soft rounded-pill">
              <i class="bi bi-geo-alt me-1"></i> Texas
            </a>
          </div>
        </div>
      </section>

      <div class="row g-4">
        <div class="col-12 col-lg-7">
          <div class="p-4 glass">
            <h2 class="h5 mb-2">How it works</h2>
            <p class="text-muted mb-0">
              Use the search bar above or the quick picks to jump in. Each dealer page shows a
              live rating, recent reviews, and purchase details from real shoppers.
            </p>
          </div>
        </div>
        <div class="col-12 col-lg-5">
          <div class="p-4 glass d-flex align-items-center justify-content-between">
            <div>
              <div class="h2 mb-0"><i class="bi bi-stars me-2"></i>Trusted</div>
              <div class="text-muted">Transparent, community-powered reviews</div>
            </div>
            <div class="text-end">
              <div class="h2 mb-0"><i class="bi bi-geo-alt me-2"></i>Nearby</div>
              <div class="text-muted">Find dealers close to you</div>
            </div>
          </div>
        </div>
      </div>
    </template>

    <template id="tpl-contact">
      <div class="p-4 glass">
        <h1 class="h4 mb-3">Contact</h1>
        <p class="mb-1">Questions, feedback, or issues?</p>
        <ul class="mb-0">
          <li>Email: <a href="mailto:support@dealersplus.example">support@dealersplus.example</a></li>
          <li>Twitter/X: <a href="https://x.com" target="_blank" rel="noreferrer">DM us</a></li>
        </ul>
      </div>
    </template>

    <template id="tpl-dealers">
      <div class="p-3 p-md-4 glass">
        <div class="d-flex flex-wrap align-items-end gap-2 mb-3">
          <div>
            <label for="stateSelect" class="form-label mb-1">Filter by state</label>
            <select id="stateSelect" class="form-select" style="min-width: 180px">
              <option value="">All states</option>
            </select>
          </div>
          <button id="btnStateApply" class="btn btn-primary">Apply</button>
          <div class="ms-auto">
            <a class="btn btn-outline-secondary" href="#/">Home</a>
            <a class="btn btn-outline-secondary" href="#/about">About</a>
            <a class="btn btn-outline-secondary" href="#/contact">Contact</a>
          </div>
        </div>

        <div id="noResults" class="alert alert-info d-none">
          No matching results. Try a different search.
        </div>

        <div class="table-responsive">
          <table class="table align-middle">
            <thead>
              <tr>
                <th>Dealer</th>
                <th>City</th>
                <th>State</th>
                <th>Brands</th>
                <th class="text-center">Rating</th>
                <th class="text-center">Reviews</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="dealersTbody"></tbody>
          </table>
        </div>
      </div>
    </template>

    <template id="tpl-dealer-detail">
      <div class="p-3 p-md-4 glass">
        <div class="d-flex flex-wrap justify-content-between align-items-center">
          <div>
            <h1 class="h4 mb-1" id="dealerName">Dealer</h1>
            <div class="text-muted" id="dealerMeta"></div>
          </div>
          <div class="text-end mt-3 mt-md-0">
            <div class="fs-4 fw-semibold" id="dealerRating">0.0</div>
            <div id="dealerStars"></div>
            <button id="btnAddReview" class="btn btn-primary mt-2">
              <i class="bi bi-pencil-square me-1"></i> Write a review
            </button>
          </div>
        </div>

        <hr />

        <div class="row gy-3" id="reviewsList"></div>
        <!-- "View more" button will be appended here by app.js -->
      </div>
    </template>

    <!-- Account Modal -->
    <div class="modal fade" id="accountModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content glass">
          <div class="modal-header">
            <h5 id="accountTitle" class="modal-title">Sign in</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div id="accountAlert" class="alert d-none" role="alert"></div>

            <!-- Login -->
            <form id="formLogin">
              <div class="mb-3">
                <label class="form-label">Username</label>
                <input id="loginUsername" type="text" class="form-control" autocomplete="username" required />
              </div>
              <div class="mb-3">
                <label class="form-label">Password</label>
                <input id="loginPassword" type="password" class="form-control" autocomplete="current-password" required />
              </div>
              <div class="d-flex justify-content-between">
                <button type="submit" class="btn btn-primary">Sign in</button>
                <div class="d-flex gap-2">
                  <button type="button" id="btnShowRegister" class="btn btn-link">Create account</button>
                  <button type="button" id="btnForgot" class="btn btn-link">Forgot?</button>
                </div>
              </div>
            </form>

            <!-- Register -->
            <form id="formRegister" class="d-none mt-2">
              <div class="row g-2">
                <div class="col-md-6">
                  <label class="form-label">First name</label>
                  <input id="regFirst" type="text" class="form-control" required />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Last name</label>
                  <input id="regLast" type="text" class="form-control" required />
                </div>
              </div>
              <div class="mt-2">
                <label class="form-label">Username</label>
                <input id="regUser" type="text" class="form-control" autocomplete="username" required />
              </div>
              <div class="row g-2 mt-1">
                <div class="col-md-6">
                  <label class="form-label">Password</label>
                  <input id="regPass" type="password" class="form-control" autocomplete="new-password" required />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Confirm</label>
                  <input id="regPass2" type="password" class="form-control" autocomplete="new-password" required />
                </div>
              </div>
              <div id="regMismatch" class="text-danger small mt-1 d-none"></div>
              <div class="d-flex justify-content-between mt-3">
                <button type="button" id="btnBackToLogin1" class="btn btn-link">Back</button>
                <button type="submit" class="btn btn-primary">Create account</button>
              </div>
            </form>

            <!-- Forgot / Verify + Reset -->
            <form id="formForgot" class="d-none mt-2">
              <div class="mb-2">
                <label class="form-label">Username</label>
                <input id="fgUser" type="text" class="form-control" required />
              </div>
              <div class="row g-2">
                <div class="col-md-6">
                  <label class="form-label">First name</label>
                  <input id="fgFirst" type="text" class="form-control" required />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Last name</label>
                  <input id="fgLast" type="text" class="form-control" required />
                </div>
              </div>

              <div id="resetSection" class="d-none mt-3">
                <div class="row g-2">
                  <div class="col-md-6">
                    <label class="form-label">New password</label>
                    <input id="fgPass" type="password" class="form-control" autocomplete="new-password" />
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">Confirm</label>
                    <input id="fgPass2" type="password" class="form-control" autocomplete="new-password" />
                  </div>
                </div>
                <div id="fgMismatch" class="text-danger small mt-1 d-none"></div>
                <button type="button" id="btnDoReset" class="btn btn-outline-primary mt-2 d-none">Reset</button>
              </div>

              <div class="d-flex justify-content-between mt-3">
                <button type="button" id="btnBackToLogin2" class="btn btn-link">Back</button>
                <button type="submit" id="btnForgotSubmit" class="btn btn-primary">Submit</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Review Modal -->
    <div class="modal fade" id="reviewModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <form id="reviewForm" class="modal-content glass">
          <div class="modal-header">
            <h5 class="modal-title">Write a review</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div id="rfAlert" class="alert d-none" role="alert"></div>

            <div class="mb-2">
              <label class="form-label me-2">Rating</label>
              <div id="rfStars" class="star-input" data-value="0"></div>
              <input id="rfRating" type="hidden" value="0" />
            </div>

            <div class="mb-3">
              <label class="form-label">Your review</label>
              <textarea id="rfText" class="form-control" rows="4" required></textarea>
            </div>

            <div class="row g-2">
              <div class="col-12">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="rfPurchase" />
                  <label class="form-check-label" for="rfPurchase">I purchased a vehicle</label>
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Purchase date</label>
                <input id="rfDate" type="text" class="form-control" placeholder="MM/DD/YYYY" />
              </div>
              <div class="col-md-6">
                <label class="form-label">Year</label>
                <input id="rfYear" type="number" min="1980" max="2099" class="form-control" />
              </div>
              <div class="col-md-6">
                <label class="form-label">Make</label>
                <input id="rfMake" type="text" class="form-control" />
              </div>
              <div class="col-md-6">
                <label class="form-label">Model</label>
                <input id="rfModel" type="text" class="form-control" />
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
            <button class="btn btn-primary" type="submit">Submit review</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Tiny theme controller (isolated; does not touch your app.js logic) -->
    <script>
      (function () {
        const root = document.documentElement;
        const orb = () => document.getElementById("themeToggle");
        const saved = localStorage.getItem("dpTheme");
        if (saved === "dark") root.setAttribute("data-theme", "dark");
        updateOrb();

        function updateOrb() {
          const isDark = root.getAttribute("data-theme") === "dark";
          if (orb()) orb().setAttribute("data-next", isDark ? "light" : "dark");
        }

        document.addEventListener("click", function (e) {
          if (e.target && e.target.id === "themeToggle") {
            const isDark = root.getAttribute("data-theme") === "dark";
            const next = isDark ? "light" : "dark";
            if (next === "dark") root.setAttribute("data-theme", "dark");
            else root.removeAttribute("data-theme");
            localStorage.setItem("dpTheme", next);
            updateOrb();
          }
        });
      })();
    </script>

    <script src="./app.js"></script>
  </body>
</html>
